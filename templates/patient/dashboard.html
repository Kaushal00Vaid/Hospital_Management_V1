{% extends "boilerplate.html" %} {% block body %}
<div class="dashboard-section py-5">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="fw-bold">Welcome, {{ current_user.name }}!</h1>
        <p class="text-muted">
          Manage your appointments and view your health records.
        </p>
      </div>
      <div>
        <a
          href="{{ url_for('edit_patient', patient_id=current_user.patient_profile.id) }}"
          class="btn btn-outline-custom me-2"
          >Edit Profile</a
        >
        <a href="{{ url_for('find_doctor') }}" class="btn btn-custom btn-lg"
          ><i class="fa-solid fa-calendar-plus me-2"></i>Book New Appointment</a
        >
      </div>
    </div>

    <!-- <div class="card shadow-sm mb-5">
      <div class="card-header bg-white p-3">
        <h4 class="mb-0">Find a Doctor</h4>
      </div>
      <div class="card-body">
        <form
          action="{{ url_for('user_dashboard') }}"
          method="GET"
          class="d-flex"
        >
          <input
            class="form-control me-2"
            type="search"
            name="doctor_search"
            placeholder="Search by name or specialty..."
            value="{{ doctor_query or '' }}"
          />
          <button class="btn btn-outline-custom" type="submit">Search</button>
        </form>
        <div class="table-responsive mt-3">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Doctor Name</th>
                <th>Specialty</th>
                <th>Availability</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for user, doctor in doctors %}
              <tr>
                <td>{{ user.name }}</td>
                <td>{{ doctor.specialization }}</td>
                <td>{{ doctor.availability }}</td>
                <td>
                  <a
                    href="{{ url_for('book_appointment', doctor_id=doctor.id) }}"
                    class="btn btn-sm btn-success"
                    >Book Now</a
                  >
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="4" class="text-center">No doctors found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div> -->

    <div class="card shadow-sm">
      <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs">
          <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#upcoming"
              >Upcoming Appointments</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#past"
              >Past Appointments</a
            >
          </li>
        </ul>
      </div>
      <div class="card-body">
        <div class="tab-content">
          <div class="tab-pane fade show active" id="upcoming">
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <tbody>
                  {% for appt in upcoming_appointments %}
                  <tr>
                    <td>{{ appt.doctor.user.name }}</td>
                    <td>
                      {{ appt.appointment_date.strftime('%Y-%m-%d at %I:%M %p')
                      }}
                    </td>
                    <td>
                      {% if appt.status == 'Scheduled' %}
                      <span class="badge bg-success">Scheduled</span>
                      {% elif appt.status == 'Cancelled' %}
                      <span class="badge bg-danger">Cancelled</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if appt.status == 'Scheduled' %}
                      <a
                        href="{{ url_for('reschedule_appointment', appointment_id=appt.id) }}"
                        class="btn btn-sm btn-outline-secondary"
                        >Reschedule</a
                      >

                      <form
                        action="{{ url_for('cancel_appointment', appointment_id=appt.id) }}"
                        method="POST"
                        class="d-inline"
                      >
                        <button
                          type="submit"
                          class="btn btn-sm btn-outline-danger"
                          onclick="return confirm('Are you sure you want to cancel this appointment?');"
                        >
                          Cancel
                        </button>
                      </form>
                      {% elif appt.status == 'Cancelled' %} - {% endif %}
                    </td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="4" class="text-center">
                      You have no upcoming appointments.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="past">
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Doctor</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for appt in past_appointments %}
                  <tr>
                    <td>{{ appt.doctor.user.name }}</td>
                    <td>{{ appt.appointment_date.strftime('%Y-%m-%d') }}</td>
                    <td>
                      {% if appt.status == 'Completed' %}
                      <span class="badge bg-secondary">Completed</span>
                      {% elif appt.status == 'Cancelled' %}
                      <span class="badge bg-danger">Cancelled</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if appt.status == 'Completed' and appt.treatment %}
                      <a
                        href="{{ url_for('view_diagnosis', appointment_id=appt.id) }}"
                        class="btn btn-sm btn-primary"
                        >View Diagnosis</a
                      >
                      {% else %}
                      <a
                        href="#"
                        class="btn btn-sm btn-outline-secondary disabled"
                        >No Record</a
                      >
                      {% endif %}
                    </td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="4" class="text-center">
                      You have no past appointments.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
